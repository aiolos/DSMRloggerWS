<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Willem Aandewiel">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Integratie Home Assistant - DSMRloggerWS</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Integratie Home Assistant";
    var mkdocs_page_input_path = "integratieHassio.md";
    var mkdocs_page_url = "/index.php/2018/08/28/slimme-meter-uitlezer/integratieHassio/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/c++.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> DSMRloggerWS</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Documentatie DSMRloggerWS</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../introductie/">Introductie</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Voorbereiding</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../installatieArduinoIDE/">ArduinoIDE</a>
                </li>
                <li class="">
                    
    <a class="" href="../installatieESP8266core/">ESP8266 Core</a>
                </li>
                <li class="">
                    
    <a class="" href="../installatieDataUploadTool/">Data Upload Tool</a>
                </li>
                <li class="">
                    
    <a class="" href="../installatieBibliotheken/">Installeren Bibliotheken</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Firmware</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../benodigdeBibliotheken/">Benodigd Bibliotheken</a>
                </li>
                <li class="">
                    
    <a class="" href="../clonenFirmware/">DSMRloggerWS firmware</a>
                </li>
                <li class="">
                    
    <a class="" href="../uploadFirmware_V4/">Firmware Flashen DSMR-logger v4</a>
                </li>
                <li class="">
                    
    <a class="" href="../uploadDataMap_V4/">Data Flashen DSMR-logger v4</a>
                </li>
                <li class="">
                    
    <a class="" href="../uploadFirmware_V3/">Firmware Flashen DSMR-logger v3</a>
                </li>
                <li class="">
                    
    <a class="" href="../uploadDataMap_V3/">Data Flashen DSMR-logger v3</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Selectie Functies</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../overzichtFuncties/">Overzicht</a>
                </li>
                <li class="">
                    
    <a class="" href="../Is_ESP12/">DSMR-logger V4 met ESP-12</a>
                </li>
                <li class="">
                    
    <a class="" href="../Use_Update_Server/">Over The Air update</a>
                </li>
                <li class="">
                    
    <a class="" href="../Has_OLED_SSD1306/">0.96" OLED display</a>
                </li>
                <li class="">
                    
    <a class="" href="../Has_OLED_SH1106/">1.3" OLED display</a>
                </li>
                <li class="">
                    
    <a class="" href="../Use_MQTT/">Gebruik MQTT</a>
                </li>
                <li class="">
                    
    <a class="" href="../Use_Mindergas/">Gebruik mindergas.nl</a>
                </li>
                <li class="">
                    
    <a class="" href="../Use_Pre40_Protocol/">Pr√© DSMR 4.0 Slimme Meters</a>
                </li>
                <li class="">
                    
    <a class="" href="../Use_NTP_Time/">Network Time</a>
                </li>
                <li class="">
                    
    <a class="" href="../SM_Has_No_Fase_Info/">SM geeft geen info per Fase</a>
                </li>
                <li class="">
                    
    <a class="" href="../Show_Passwrds/">Toon wachtwoorden</a>
                </li>
                <li class="">
                    
    <a class="" href="../Has_No_Meter/">Test mode</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Hardware</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../hardware_V4/">DSMR-logger v4</a>
                </li>
                <li class="">
                    
    <a class="" href="../hardware_V4.5/">DSMR-logger v4.5</a>
                </li>
                <li class="">
                    
    <a class="" href="../hardware_V4_Programmer/">Programmer DSMR-logger v4</a>
                </li>
                <li class="">
                    
    <a class="" href="../hardware_V3/">DSMR-logger v3</a>
                </li>
                <li class="">
                    
    <a class="" href="../hardware_V3_Programmer/">Programmer DSMR-logger v3</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Overigen</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../Opstarten/">(eerste keer) Opstarten</a>
                </li>
                <li class="">
                    
    <a class="" href="../restAPI/">restAPI</a>
                </li>
                <li class="">
                    
    <a class="" href="../verschillenESP8266/">Verschillen ESP8266 modules</a>
                </li>
                <li class="">
                    
    <a class="" href="../PUYA_patch/">PUYA chips</a>
                </li>
                <li class="">
                    
    <a class="" href="../QenA/">Vragen en Antwoorden</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Intergratie met andere systemen</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../integratieDomoticz/">Integratie Domoticz</a>
                </li>
                <li class="">
                    
    <a class="" href="../integratieHomey/">Integratie Homey</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Integratie Home Assistant</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#integratie-dsmr-logger-met-home-assistant">Integratie DSMR-logger met Home Assistant</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../integratieMindergas/">Integratie Mindergas.nl</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">telnet</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../telnet/">logging output</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../MITlicense/">License</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">DSMRloggerWS</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Intergratie met andere systemen &raquo;</li>
        
      
    
    <li>Integratie Home Assistant</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="integratie-dsmr-logger-met-home-assistant">Integratie DSMR-logger met Home Assistant</h2>
<p>(met dank aan Bas van de Lustgraaf)</p>
<p>De data uit de DSMR-logger kan op verschillende manieren met
Home Assistant gedeeld worden. Verreweg het makkelijkste is dat
door gebruik te maken van een MQTT Broker.<br />
De DSMR-logger publiceert de gegevens uit de Slimme Meter in een
bepaald topic. Home Assistant moet dan een subscription op dat
zelfde topic hebben om zo de gegevens in te lezen en te presenteren.</p>
<p>Vaak draait Home Assistant thuis op een server (Raspberry Pi
of anderszins) en is het eenvoudig om op die server ook een
(Mosquitto) MQTT broker te installeren (veel installaties van
Home Assistant hebben dat al standaard gedaan). </p>
<p>Om de intergratie voor elkaar te krijgen moet in het <code>configuratie.yaml</code> 
bestand van Home Assistant onder andere deze instellingen
komen te staan:</p>
<pre><code>group:  !include_dir_merge_named groups/
script: !include scripts.yaml
sensor: !include_dir_merge_list sensors/
switch: !include_dir_merge_list switches/
light:  !include_dir_merge_list lights/
camera: !include_dir_merge_list cameras/

mqtt:
  broker: &lt;ip-adres-MQTT-broker&gt;
  port: 1883
  client_id: HassIO
  keepalive: 60
  username: &lt;user name&gt;
  password: &lt;password&gt;

</code></pre>

<p>Hierdoor zal Home Assistant alle (yaml) bestanden die in de sub-map
<code>groups/</code> staan inlezen. Hetzelfde geldt voor de sub-mappen
<code>sensors/</code>, <code>switches/</code>, <code>lights/</code> en <code>cameras/</code>.</p>
<p>Voor de koppeling met de DSMR-logger zijn alleen de sub-mappen
<code>groups/</code> en <code>sensors/</code> van belang en natuurlijk de settings
voor de <code>MQTT broker</code>!</p>
<p>In de sub-map <code>groups/</code> komt een bestand <code>DSMR-Actueel.yaml</code> met 
de volgende inhoud:</p>
<pre><code>###group: ###
###VIEWS###

Energie:
  name: Energie
  entities:
    - group.Energie_Verbruik
    - group.Energie_Teruglevering
    - group.DSMR_Last_Update
    - group.Energy_Graph1
    - group.LastUpdate

###CARDS###
DSMR_Last_Update:
  name: DSMR Last Update
  entities:
    - sensor.DSMR_Last_Update

Energie_Verbruik:
  name: Energie Verbruik (actueel)
  entities:
    - sensor.Energy_Delivered_T1
    - sensor.Energy_Delivered_T2
    - sensor.Power_Delivered
    - sensor.Power_Delivered_l1
    - sensor.Power_Delivered_l2
    - sensor.Power_Delivered_l3
    - sensor.Gas_Delivered

Energie_Teruglevering:
  name: Energie Teruglevering (actueel)
  entities:
    - sensor.Energy_Returned_T1
    - sensor.Energy_Returned_T2
    - sensor.Power_Returned
    - sensor.Power_Returned_l3

Energy_Graph1:
  name: Energy Graph 1
  entities:
    - history.energyGraph1

</code></pre>

<p>en in de sub-map <code>sensors/</code> komt een bestand <code>DSMR-Actueel.yaml</code>
met deze inhoud:</p>
<pre><code>### sensor: ###
### DSMR-WS ###

- platform: mqtt
  name: &quot;DSMR Last Update&quot;
  state_topic: &quot;DSMR-WS/JSON/timestamp&quot;
  unit_of_measurement: &quot;&quot;
  value_template: &quot;[[ strptime(value_json.timestamp, '%y%m%d%H%M%SW') ]]&quot;

- platform: mqtt
  name: &quot;Energy Delivered T1&quot;
  state_topic: &quot;DSMR-WS/JSON/energy_delivered_tariff1&quot; 
  unit_of_measurement: &quot;kWh&quot;
  value_template: '[[ value_json.energy_delivered_tariff1 | round(3) ]]'

- platform: mqtt
  name: &quot;Energy Delivered T2&quot;
  state_topic: &quot;DSMR-WS/JSON/energy_delivered_tariff2&quot; 
  unit_of_measurement: &quot;kWh&quot;
  value_template: '[[ value_json.energy_delivered_tariff2 | round(3) ]]'

- platform: mqtt
  name: &quot;Energy Returned T1&quot;
  state_topic: &quot;DSMR-WS/JSON/energy_returned_tariff1&quot; 
  unit_of_measurement: &quot;kWh&quot;
  value_template: '[[ value_json.energy_returned_tariff1 | round(3) ]]'

- platform: mqtt
  name: &quot;Energy Returned T2&quot;
  state_topic: &quot;DSMR-WS/JSON/energy_returned_tariff2&quot; 
  unit_of_measurement: &quot;kWh&quot;
  value_template: '[[ value_json.energy_returned_tariff2 | round(3) ]]'

- platform: mqtt
  name: &quot;Power Delivered&quot;
  state_topic: &quot;DSMR-WS/JSON/power_delivered&quot; 
  unit_of_measurement: &quot;kW&quot;
  value_template: '[[ value_json.power_delivered | round(3) ]]'

- platform: mqtt
  name: &quot;Power Returned&quot;
  state_topic: &quot;DSMR-WS/JSON/power_returned&quot;
  unit_of_measurement: &quot;kW&quot;
  value_template: &quot;[[ value_json.power_returned | round(3) ]]&quot;

- platform: mqtt
  name: &quot;Power Delivered l1&quot;
  state_topic: &quot;DSMR-WS/JSON/power_delivered_l1&quot; 
  unit_of_measurement: &quot;Watt&quot;
  value_template: '[[ value_json.power_delivered_l1 | round(1) ]]'

- platform: mqtt
  name: &quot;Power Delivered l2&quot;
  state_topic: &quot;DSMR-WS/JSON/power_delivered_l2&quot; 
  unit_of_measurement: &quot;Watt&quot;
  value_template: '[[ value_json.power_delivered_l2 | round(1) ]]'

- platform: mqtt
  name: &quot;Power Delivered l3&quot;
  state_topic: &quot;DSMR-WS/JSON/power_delivered_l3&quot; 
  unit_of_measurement: &quot;Watt&quot;
  value_template: '[[ value_json.power_delivered_l3 | round(1) ]]'

- platform: mqtt
  name: &quot;Power Returned l1&quot;
  state_topic: &quot;DSMR-WS/JSON/power_returned_l1&quot;
  unit_of_measurement: &quot;Watt&quot;
  value_template: '[[ value_json.power_returned_l1 | round(1) ]]'

- platform: mqtt
  name: &quot;Power Returned l2&quot;
  state_topic: &quot;DSMR-WS/JSON/power_returned_l2&quot;
  unit_of_measurement: &quot;Watt&quot;
  value_template: '[[ value_json.power_returned_l2 | round(1) ]]'

- platform: mqtt
  name: &quot;Power Returned l3&quot;
  state_topic: &quot;DSMR-WS/JSON/power_returned_l3&quot;
  unit_of_measurement: &quot;Watt&quot;
  value_template: '[[ value_json.power_returned_l3 | round(1) ]]'

- platform: mqtt
  name: &quot;Gas Delivered&quot;
  state_topic: &quot;DSMR-WS/JSON/gas_delivered&quot;
  unit_of_measurement: &quot;m3&quot;
  value_template: '[[ value_json.gas_delivered | round(2) ]]'

</code></pre>

<div class="admonition note">
<p class="admonition-title">Let op!</p>
github pages kan niet tegen dubbele '<b>{</b>' tekens omdat hij dan denkt
dat er een variabele moet worden gesubstitueerd. Daarom heb ik
in bovenstaande source bij de <b>value_template</b>'s dubbele
 '<b>[</b>' en '<b>]</b>' gezet waar dit dus
dubbele '<b>{</b>' en '<b>}</b>' moeten zijn!!!
</div>

<p><img alt="" src="../img/HassIO-DSMR-data.png" /></p>
<hr>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../integratieMindergas/" class="btn btn-neutral float-right" title="Integratie Mindergas.nl">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../integratieHomey/" class="btn btn-neutral" title="Integratie Homey"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>
  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <br>copyright &copy; 2019-2020 <a href="https://willem.aandewiel.nl/index.php/2019/04/09/dsmr-logger-v4-slimme-meter-uitlezer/">Willem Aandewiel</a>
    
    
	<br><small>DSMRloggerWS Version 1.0.5 </small>
    
    
        <br><small><i>Deze pagina is <b>2020-04-14</b> voor het laatst bijgewerkt.</i></small>
    
<br>
  <small>
  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  </small>
  </div>
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../integratieHomey/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../integratieMindergas/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
